<footer class="jb-footer bg-gradient-dark text-light py-5 mt-5">
  <div class="jb-footer__container container-fluid">
    <div class="jb-footer__row row justify-content-center">
      <!-- Column 1: Community -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">Community</h5>
        <div
          class="jb-footer__social-icons mb-3 justify-content-center justify-content-md-start"
        >
          <a
            href="https://x.com/JBChangelogs"
            class="jb-footer__social-link me-3"
            title="Follow us on X (Twitter)"
            rel="noopener noreferrer"
          >
            <i class="bi bi-twitter-x fs-4"></i>
          </a>
          <a
            href="https://discord.gg/kAuxDntHG9"
            class="jb-footer__social-link"
            title="Join our Discord Server"
            rel="noopener noreferrer"
          >
            <i class="bi bi-discord fs-4"></i>
          </a>
        </div>
        <ul class="jb-footer__list list-unstyled">
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://www.reddit.com/r/robloxjailbreak/"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-reddit me-2"></i>r/RobloxJailbreak
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://discord.com/invite/tWbDg7MbUU"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-discord me-2"></i>r/RobloxJailbreak Discord
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://discord.gg/jailbreak"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-discord me-2"></i>Official Jailbreak Discord
            </a>
          </li>
        </ul>
      </div>

      <!-- Column 2: Resources -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">Resources</h5>
        <ul class="jb-footer__list list-unstyled">
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://jailbreak.fandom.com/wiki/Jailbreak_Wiki:Home"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-book me-2"></i>Jailbreak Wiki
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://docs.jailbreakchangelogs.xyz/"
              class="jb-footer__link"
            >
              <i class="bi bi-file-earmark-text me-2"></i>API Documentation
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a href="/faq" class="jb-footer__link">
              <i class="bi bi-question-circle me-2"></i>FAQ
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a href="/bot" class="jb-footer__link">
              <i class="bi bi-robot me-2"></i>Discord Bot
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://status.jailbreakchangelogs.xyz/"
              class="jb-footer__link"
            >
              <i class="bi bi-check-circle me-2"></i>Service Status
            </a>
          </li>
        </ul>
      </div>

      <!-- Column 3: About -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">About</h5>
        <p class="jb-footer__disclaimer mb-3">
          This project is
          <strong class="text-warning">NOT affiliated with Badimo.</strong>
        </p>
        <p class="jb-footer__text mb-3">
          We are open source and welcome your contributions!
        </p>
        <div class="jb-footer__buttons mb-3">
          <a
            href="https://github.com/JBChangelogs/JailbreakChangelogs"
            class="jb-footer__button btn btn-outline-light btn-sm me-2 mb-2"
            rel="noopener noreferrer"
          >
            <i class="bi bi-github me-1"></i>View on GitHub
          </a>
          <a
            href="#"
            class="jb-footer__button btn btn-outline-light btn-sm mb-2"
            data-bs-toggle="modal"
            data-bs-target="#reportIssueModal"
            title="Report an Issue"
          >
            <i class="bi bi-bug me-1"></i>Report Issue
          </a>
        </div>
        <p class="jb-footer__maintainers small mb-2">
          Maintained by
          <a
            href="https://www.roblox.com/users/435983066/profile"
            class="jb-footer__maintainer-link"
            rel="noopener noreferrer"
            >Jakobiis</a
          >
          and
          <a
            href="https://www.roblox.com/users/1910948809/profile"
            class="jb-footer__maintainer-link"
            rel="noopener noreferrer"
            >Jalenzz16</a
          >
        </p>
        <p class="jb-footer__version small mb-1">
          Version:
          <a
            id="version-link"
            href="https://github.com/JBChangelogs/JailbreakChangelogs/actions/workflows/npm-publish-github-packages.yml"
            target="_blank"
            class="jb-footer__link jb-footer__link--version text-muted"
            rel="noopener noreferrer"
          >
            <span id="version-number">Loading...</span>
          </a>
        </p>
        <p class="jb-footer__updated small mb-0">
          Last Updated:
          <span id="last-updated" class="jb-footer__timestamp text-muted"
            >Loading...</span
          >
        </p>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="jb-footer__bottom row mt-4 pt-4 border-top border-secondary">
      <div class="col-12 text-center">
        <p class="jb-footer__timezone-text small text-muted mb-3">
          Release dates are recorded in the U.S. (EST/EDT) time zone. Some dates
          may be inaccurate due to differing time zones.
        </p>
        <p class="jb-footer__copyright small mb-2"></p>
        <div class="jb-footer__links">
          <a href="privacy" class="jb-footer__legal-link small mx-2"
            >Privacy Policy</a
          >
          <span class="text-muted">•</span>
          <a href="tos" class="jb-footer__legal-link small mx-2"
            >Terms of Service</a
          >
          <span class="text-muted">•</span>
          <a
            href="mailto:support@jailbreakchangelogs.xyz"
            class="jb-footer__legal-link small mx-2"
            >Contact Us</a
          >
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Report Issue Modal -->
<div
  class="modal fade"
  id="reportIssueModal"
  tabindex="-1"
  aria-labelledby="reportIssueModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="reportIssueModalLabel">Report an Issue</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div id="successMessage" class="alert alert-success d-none">
          Thank you for reporting this issue. We will look into it shortly.
        </div>
        <form id="reportIssueForm">
          <div class="mb-3">
            <label for="issueTitle" class="form-label"
              >Title (minimum <%= MIN_TITLE_LENGTH %> characters)</label
            >
            <input
              type="text"
              class="form-control bg-dark text-light"
              id="issueTitle"
              required
              minlength="<%= MIN_TITLE_LENGTH %>"
            />
          </div>
          <div class="mb-3">
            <label for="issueDescription" class="form-label"
              >Description (minimum <%= MIN_DESCRIPTION_LENGTH %>
              characters)</label
            >

            <textarea
              class="form-control bg-dark text-light"
              id="issueDescription"
              rows="3"
              required
              minlength="<%= MIN_DESCRIPTION_LENGTH %>"
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-primary" id="submitIssue">
          Submit Issue
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Update copyright year automatically
  document.addEventListener("DOMContentLoaded", () => {
    const copyrightElement = document.querySelector(".jb-footer__copyright");
    if (copyrightElement) {
      const currentYear = new Date().getFullYear();
      copyrightElement.innerHTML = `&copy; ${currentYear} Jailbreak Changelogs. All rights reserved.`;
    }
  });

  function dismissBanner(type) {
    const banner = document.getElementById(
      type === "testing" ? "testing-banner" : "prod-banner"
    );
    banner.style.display = "none";

    // Store dismissal time
    const dismissalTime = new Date().getTime();
    localStorage.setItem(`${type}BannerDismissed`, dismissalTime.toString());
  }

  // Check if banner should be shown based on time elapsed
  document.addEventListener("DOMContentLoaded", () => {
    const hostname = window.location.hostname;
    const bannerType =
      hostname === "testing.jailbreakchangelogs.xyz" ? "testing" : "prod";
    const banner = document.getElementById(`${bannerType}-banner`);

    if (banner) {
      const dismissedTime = localStorage.getItem(
        `${bannerType}BannerDismissed`
      );
      if (dismissedTime) {
        const timeElapsed = new Date().getTime() - parseInt(dismissedTime);
        const thirtyMinutes = 30 * 60 * 1000; // 30 minutes in milliseconds

        if (timeElapsed < thirtyMinutes) {
          banner.style.display = "none";
        }
      }
    }

    // Handle issue submission
    const reportIssueBtn = document.querySelector(
      '[data-bs-target="#reportIssueModal"]'
    );
    const token = document.cookie
      .split("; ")
      .find((row) => row.startsWith("token="));
    const userId = sessionStorage.getItem("userId");
    const userData = sessionStorage.getItem("user");

    // Check if either userId directly or user object exists
    const hasValidUser = userId || (userData && JSON.parse(userData).id);

    // Replace the existing disabled button code with this
    if (!token || !hasValidUser) {
      // User is not authenticated
      reportIssueBtn.classList.add("disabled");
      reportIssueBtn.setAttribute("data-bs-toggle", "tooltip"); // Change to bootstrap tooltip
      reportIssueBtn.setAttribute("data-bs-placement", "top");
      reportIssueBtn.setAttribute("title", "Please sign in to report issues");

      // Initialize the tooltip
      new bootstrap.Tooltip(reportIssueBtn);

      // Remove the modal trigger
      reportIssueBtn.removeAttribute("data-bs-target");
      reportIssueBtn.onclick = (e) => {
        e.preventDefault();
      };
    } else {
      // Remove disabled state if it was previously set
      reportIssueBtn.classList.remove("disabled");
      reportIssueBtn.removeAttribute("title");
      reportIssueBtn.style.cursor = "pointer";

      // Get the actual user ID either from userId or user object
      const actualUserId = userId || JSON.parse(userData).id;

      // Reset form when opening modal
      reportIssueBtn.addEventListener("click", () => {
        document.getElementById("reportIssueForm").reset();
        document.getElementById("successMessage").classList.add("d-none");
        // Re-enable form elements if they were disabled
        const form = document.getElementById("reportIssueForm");
        form
          .querySelectorAll("input, textarea")
          .forEach((el) => (el.disabled = false));
        document.getElementById("submitIssue").disabled = false;
      });

      const MIN_TITLE_LENGTH = 10;
      const MIN_DESCRIPTION_LENGTH = 25;

      // Handle issue submission
      document
        .getElementById("submitIssue")
        .addEventListener("click", async () => {
          const title = document.getElementById("issueTitle").value;
          const description = document.getElementById("issueDescription").value;

          document
            .querySelectorAll(".invalid-feedback")
            .forEach((el) => el.remove());
          document.getElementById("issueTitle").classList.remove("is-invalid");
          document
            .getElementById("issueDescription")
            .classList.remove("is-invalid");

          let hasError = false;

          if (title.length < MIN_TITLE_LENGTH) {
            const titleInput = document.getElementById("issueTitle");
            titleInput.classList.add("is-invalid");
            const errorDiv = document.createElement("div");
            errorDiv.className = "invalid-feedback";
            errorDiv.textContent = `Title must be at least ${MIN_TITLE_LENGTH} characters long`;
            titleInput.parentNode.appendChild(errorDiv);
            hasError = true;
          }

          if (description.length < MIN_DESCRIPTION_LENGTH) {
            const descriptionInput =
              document.getElementById("issueDescription");
            descriptionInput.classList.add("is-invalid");
            const errorDiv = document.createElement("div");
            errorDiv.className = "invalid-feedback";
            errorDiv.textContent = `Description must be at least ${MIN_DESCRIPTION_LENGTH} characters long`;
            descriptionInput.parentNode.appendChild(errorDiv);
            hasError = true;
          }

          if (title && description) {
            try {
              // Disable form while submitting
              const form = document.getElementById("reportIssueForm");
              const submitBtn = document.getElementById("submitIssue");
              form
                .querySelectorAll("input, textarea")
                .forEach((el) => (el.disabled = true));
              submitBtn.disabled = true;

              const requestData = {
                user: actualUserId,
                title: title,
                description: description,
              };

              const response = await fetch(
                "https://api3.jailbreakchangelogs.xyz/issues/add",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    Origin: "jailbreakchangelogs.xyz",
                  },

                  body: JSON.stringify(requestData),
                }
              );

              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }

              // Show success message
              const successMessage = document.getElementById("successMessage");
              successMessage.classList.remove("d-none");

              // Close modal after 2 seconds
              setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(
                  document.getElementById("reportIssueModal")
                );
                modal.hide();

                // Reset form and hide success message
                setTimeout(() => {
                  form.reset();
                  successMessage.classList.add("d-none");
                  form
                    .querySelectorAll("input, textarea")
                    .forEach((el) => (el.disabled = false));
                  submitBtn.disabled = false;
                }, 500);
              }, 2000);
            } catch (error) {
              console.error("Error submitting issue:", error);
              alert(
                "There was an error submitting your issue. Please try again."
              );

              // Re-enable form on error
              const form = document.getElementById("reportIssueForm");
              form
                .querySelectorAll("input, textarea")
                .forEach((el) => (el.disabled = false));
              document.getElementById("submitIssue").disabled = false;
            }
          }
        });
    }
  });
</script>
<style>
  .tooltip {
    pointer-events: none;
  }

  .btn.disabled {
    pointer-events: auto !important;
  }
</style>
