<footer class="jb-footer bg-gradient-dark text-light py-5 mt-5">
  <div class="jb-footer__container container-fluid">
    <div class="jb-footer__row row justify-content-center">
      <!-- Column 1: Community -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">Community</h5>
        <div
          class="jb-footer__social-icons mb-3 justify-content-center justify-content-md-start"
        >
          <a
            href="https://x.com/JBChangelogs"
            class="jb-footer__social-link me-3"
            title="Follow us on X (Twitter)"
            rel="noopener noreferrer"
          >
            <i class="bi bi-twitter-x fs-4"></i>
          </a>
          <a
            href="https://discord.gg/kAuxDntHG9"
            class="jb-footer__social-link me-3"
            title="Join our Discord Server"
            rel="noopener noreferrer"
          >
            <i class="bi bi-discord fs-4"></i>
          </a>
          <a
            href="https://www.roblox.com/communities/35348206/Jailbreak-Changelogs#!/about"
            class="jb-footer__social-link"
            title="Join Our Roblox Group"
            rel="noopener noreferrer"
          >
            <svg
              class="fs-4 me-2"
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M20.4,5.6L7.6,2.4C7.466,2.366,7.331,2.35,7.199,2.35c-0.739,0-1.411,0.5-1.599,1.25L2.4,16.4	c-0.221,0.884,0.316,1.779,1.2,2l12.8,3.2c0.134,0.034,0.269,0.05,0.401,0.05c0.739,0,1.411-0.5,1.599-1.25l3.2-12.8	C21.821,6.716,21.284,5.821,20.4,5.6z M9.155,12.882l0.749-3c0.114-0.454,0.521-0.758,0.969-0.758c0.08,0,0.162,0.01,0.243,0.03	l3,0.75c0.536,0.134,0.861,0.677,0.728,1.213l-0.749,2.999c-0.114,0.454-0.521,0.758-0.969,0.758c-0.08,0-0.162-0.01-0.243-0.03	l-3-0.75C9.347,13.961,9.021,13.418,9.155,12.882z"
              ></path>
            </svg>
          </a>
        </div>
        <ul class="jb-footer__list list-unstyled">
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://www.reddit.com/r/robloxjailbreak/"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-reddit me-2"></i>r/RobloxJailbreak
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://discord.com/invite/tWbDg7MbUU"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-discord me-2"></i>r/RobloxJailbreak Discord
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://discord.gg/jailbreak"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-discord me-2"></i>Official Jailbreak Discord
            </a>
          </li>
        </ul>
      </div>

      <!-- Column 2: Resources -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">Resources</h5>
        <ul class="jb-footer__list list-unstyled">
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://jailbreak.fandom.com/wiki/Jailbreak_Wiki:Home"
              class="jb-footer__link"
              rel="noopener noreferrer"
            >
              <i class="bi bi-book me-2"></i>Jailbreak Wiki
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://docs.jailbreakchangelogs.xyz/"
              class="jb-footer__link"
            >
              <i class="bi bi-file-earmark-text me-2"></i>API Documentation
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a href="/faq" class="jb-footer__link">
              <i class="bi bi-question-circle me-2"></i>FAQ
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a href="/bot" class="jb-footer__link">
              <i class="bi bi-robot me-2"></i>Discord Bot
            </a>
          </li>
          <li class="jb-footer__list-item mb-2">
            <a
              href="https://status.jailbreakchangelogs.xyz/"
              class="jb-footer__link"
            >
              <i class="bi bi-check-circle me-2"></i>Service Status
            </a>
          </li>
        </ul>
      </div>

      <!-- Column 3: About -->
      <div class="jb-footer__section col-md-4 mb-4 text-center text-md-start">
        <h5 class="jb-footer__heading mb-3">About</h5>
        <p class="jb-footer__disclaimer mb-3">
          This project is
          <strong class="text-warning">NOT affiliated with Badimo.</strong>
        </p>
        <p class="jb-footer__text mb-3">
          We are open source and welcome your contributions!
        </p>
        <div class="jb-footer__buttons mb-3">
          <a
            href="https://github.com/JBChangelogs/JailbreakChangelogs"
            class="jb-footer__button btn btn-outline-light btn-sm me-2 mb-2"
            rel="noopener noreferrer"
          >
            <i class="bi bi-github me-1"></i>View on GitHub
          </a>
          <a
            href="#"
            class="jb-footer__button btn btn-outline-light btn-sm mb-2"
            data-bs-toggle="modal"
            data-bs-target="#reportIssueModal"
            title="Report an Issue"
          >
            <i class="bi bi-bug me-1"></i>Report Issue
          </a>
        </div>
        <p class="jb-footer__maintainers small mb-2">
          Maintained by
          <a
            href="https://www.roblox.com/users/435983066/profile"
            class="jb-footer__maintainer-link"
            rel="noopener noreferrer"
            >Jakobiis</a
          >
          and
          <a
            href="https://www.roblox.com/users/1910948809/profile"
            class="jb-footer__maintainer-link"
            rel="noopener noreferrer"
            >Jalenzz16</a
          >
        </p>
        <p class="jb-footer__version small mb-1">
          Version:
          <a
            id="version-link"
            href="https://github.com/JBChangelogs/JailbreakChangelogs/actions/workflows/npm-publish-github-packages.yml"
            target="_blank"
            class="jb-footer__link jb-footer__link--version text-muted"
            rel="noopener noreferrer"
          >
            <span id="version-number">Loading...</span>
          </a>
        </p>
        <p class="jb-footer__updated small mb-0">
          Last Updated:
          <span id="last-updated" class="jb-footer__timestamp text-muted"
            >Loading...</span
          >
        </p>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="jb-footer__bottom row mt-4 pt-4 border-top border-secondary">
      <div class="col-12 text-center">
        <p class="jb-footer__timezone-text small text-muted mb-3">
          Release dates are recorded in the U.S. (EST/EDT) time zone. Some dates
          may be inaccurate due to differing time zones.
        </p>
        <p class="jb-footer__copyright small mb-2"></p>
        <div class="jb-footer__links">
          <a href="privacy" class="jb-footer__legal-link small mx-2"
            >Privacy Policy</a
          >
          <span class="text-muted">•</span>
          <a href="tos" class="jb-footer__legal-link small mx-2"
            >Terms of Service</a
          >
          <span class="text-muted">•</span>
          <a
            href="mailto:support@jailbreakchangelogs.xyz"
            class="jb-footer__legal-link small mx-2"
            >Contact Us</a
          >
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Report Issue Modal -->
<div
  class="modal fade"
  id="reportIssueModal"
  tabindex="-1"
  aria-labelledby="reportIssueModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="reportIssueModalLabel">Report an Issue</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div id="successMessage" class="alert alert-success d-none">
          Thank you for reporting this issue. We will look into it shortly.
        </div>
        <form id="reportIssueForm">
          <div class="mb-3">
            <label for="issueTitle" class="form-label"
              >Title (minimum <%= MIN_TITLE_LENGTH %> characters)</label
            >
            <input
              type="text"
              class="form-control bg-dark text-light"
              id="issueTitle"
              required
              minlength="<%= MIN_TITLE_LENGTH %>"
            />
          </div>
          <div class="mb-3">
            <label for="issueDescription" class="form-label"
              >Description (minimum <%= MIN_DESCRIPTION_LENGTH %>
              characters)</label
            >

            <textarea
              class="form-control bg-dark text-light"
              id="issueDescription"
              rows="3"
              required
              minlength="<%= MIN_DESCRIPTION_LENGTH %>"
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-primary" id="submitIssue">
          Submit Issue
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Update copyright year automatically
  document.addEventListener("DOMContentLoaded", () => {
    const copyrightElement = document.querySelector(".jb-footer__copyright");
    if (copyrightElement) {
      const currentYear = new Date().getFullYear();
      copyrightElement.innerHTML = `&copy; ${currentYear} Jailbreak Changelogs. All rights reserved.`;
    }
  });

  // Configure toastr options
  toastr.options = {
    closeButton: true,
    progressBar: true,
    positionClass: "toast-bottom-right",
    timeOut: 3000,
  };

  // Handle issue submission
  const reportIssueBtn = document.querySelector(
    '[data-bs-target="#reportIssueModal"]'
  );
  const token = document.cookie
    .split("; ")
    .find((row) => row.startsWith("token="));
  const userId = sessionStorage.getItem("userId");
  const userData = sessionStorage.getItem("user");

  // Check if either userId directly or user object exists
  const hasValidUser = userId || (userData && JSON.parse(userData).id);

  // Handle non-authenticated users
  if (!token || !hasValidUser) {
    // User is not authenticated
    reportIssueBtn.classList.add("disabled");
    reportIssueBtn.removeAttribute("data-bs-target");
    reportIssueBtn.onclick = (e) => {
      e.preventDefault();
      toastr.error("Please sign in to report issues");

      // Redirect to login page after 3 seconds
      setTimeout(() => {
        window.location.href = "/login";
      }, 3000);
    };
  } else {
    // Remove disabled state if it was previously set
    reportIssueBtn.classList.remove("disabled");
    reportIssueBtn.removeAttribute("title");
    reportIssueBtn.style.cursor = "pointer";

    // Get the actual user ID either from userId or user object
    const actualUserId = userId || JSON.parse(userData).id;

    // Reset form when opening modal
    reportIssueBtn.addEventListener("click", () => {
      document.getElementById("reportIssueForm").reset();
      document.getElementById("successMessage").classList.add("d-none");
      // Re-enable form elements if they were disabled
      const form = document.getElementById("reportIssueForm");
      form
        .querySelectorAll("input, textarea")
        .forEach((el) => (el.disabled = false));
      document.getElementById("submitIssue").disabled = false;
    });

    document
      .getElementById("submitIssue")
      .addEventListener("click", function () {
        const title = document.getElementById("issueTitle").value;
        const description = document.getElementById("issueDescription").value;

        // Clear previous validation styling
        document
          .querySelectorAll(".invalid-feedback")
          .forEach((el) => el.remove());
        document.getElementById("issueTitle").classList.remove("is-invalid");
        document
          .getElementById("issueDescription")
          .classList.remove("is-invalid");

        let hasError = false;
        const MIN_TITLE_LENGTH = 10;
        const MIN_DESCRIPTION_LENGTH = 25;

        if (description.length < MIN_DESCRIPTION_LENGTH) {
          const descriptionInput = document.getElementById("issueDescription");
          descriptionInput.classList.add("is-invalid");
          hasError = true;
          toastr.error(
            `Description must be at least ${MIN_DESCRIPTION_LENGTH} characters long`
          );
        }

        if (title.length < MIN_TITLE_LENGTH) {
          const titleInput = document.getElementById("issueTitle");
          titleInput.classList.add("is-invalid");
          hasError = true;
          toastr.error(
            `Title must be at least ${MIN_TITLE_LENGTH} characters long`
          );
        }

        if (hasError) {
          return; // Stop submission if validation fails
        }

        // Disable form while submitting
        const form = document.getElementById("reportIssueForm");
        const submitBtn = document.getElementById("submitIssue");
        form
          .querySelectorAll("input, textarea")
          .forEach((el) => (el.disabled = true));
        submitBtn.disabled = true;

        // Submit the issue
        fetch("https://api3.jailbreakchangelogs.xyz/issues/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Origin: "jailbreakchangelogs.xyz",
          },
          body: JSON.stringify({
            user: actualUserId,
            title: title,
            description: description,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            // Show success message
            const successMessage = document.getElementById("successMessage");
            successMessage.classList.remove("d-none");

            // Clear the report-issue parameter from URL if it exists
            const url = new URL(window.location);
            if (url.searchParams.has("report-issue")) {
              url.searchParams.delete("report-issue");
              window.history.replaceState({}, "", url);
            }

            // Close modal after 2 seconds
            setTimeout(() => {
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("reportIssueModal")
              );
              modal.hide();

              // Reset form and hide success message
              setTimeout(() => {
                form.reset();
                successMessage.classList.add("d-none");
                form
                  .querySelectorAll("input, textarea")
                  .forEach((el) => (el.disabled = false));
                submitBtn.disabled = false;
              }, 500);
            }, 2000);
          })
          .catch((error) => {
            console.error("Error submitting issue:", error);
            toastr.error(
              "There was an error submitting your issue. Please try again."
            );

            // Re-enable form on error
            form
              .querySelectorAll("input, textarea")
              .forEach((el) => (el.disabled = false));
            submitBtn.disabled = false;
          });
      });
  }

  // Check for report-issue parameter
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("report-issue")) {
      if (!token || !hasValidUser) {
        toastr.error("Please sign in to report issues");
        setTimeout(() => {
          window.location.href = "/login";
        }, 3000);
      } else {
        reportIssueBtn.click();
      }
    }
  });
</script>
<style>
  .tooltip {
    pointer-events: none;
  }

  .btn.disabled {
    pointer-events: auto !important;
  }
</style>
